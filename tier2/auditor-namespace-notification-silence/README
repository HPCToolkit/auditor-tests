# Auditor namespaces (undocumentedly) differ from normal namespaces

The separate namespace used to load an auditor behaves very differently from a "normal" namespace created by the application,
however there is no indication in the auditor callbacks that a namespace falls into this "special" case. Since LD_AUDIT can
load auditors arbitrarily *all* auditors must be robust against the idiosyncrasies of auditor namespaces, complicating already
delicate auditor code.

The following differences have been found:
 1. After the initial loading of an auditor and its direct dependencies (i.e. after the first la_activity(CONSISTENT)), no other
    la_obj* or la_activity callbacks will be issued for the auditor's namespace.
 2. la_symbind is not called for PLT lookups from an auditor, but confusingly still is for dlsym lookups.
 3. The Lmid_t passed to la_objopen for auditors does not clearly differ from those generated during dlmopen(LM_ID_NEWLM),
    despite the former crashing dlmopen.

Some differences are required to prevent "in-fighting" between multiple auditors (having auditors intercept symbols in other
auditors sounds like a recipe for disaster). Many use cases however are purely "read-only" or can be selectively disabled,
it is reasonable to retain these known-good usages while removing problematic "write" interactions.

The proposed extensions to the current functionality are as follows:
 - The return value of la_objsearch should be ignored when the binary will be loaded into an auditor namespace, as if the call
   returned name. flag should be extended with a bit (e.g. LA_SER_FINAL) to indicate when this is the case.
 - la_objopen should be passed a special Lmid_t constant (e.g. LM_ID_ROLM) when the namespace is an auditor namespace. This constant
   should never be generated by dlmopen(LM_ID_NEWLM) and error when passed to dlmopen.
 - The return value of la_symbind should be ignored when refcook refers to a binary in an auditor namespace, as if the call
   returned sym->st_value and set LA_SYMB_NOPLT* in *flags. *flags should be extended with a bit (e.g. LA_SYMB_FINAL) when this is
   the case.
 - la_plt* should never be called for binaries within an auditor namespace.
 - Status as an "auditor namespace" should not be persistent, auditors should be allowed to instantiate "normal" namespaces though
   dlmopen(LM_ID_NEWLM), exposing the code in the new namespace to interception by other auditors.

Other than these exceptions, auditor namespaces should be treated identically to "normal" namespaces from the perspective of
other auditors.

### Bug reproducer
git clone https://github.com/hpctoolkit/auditor-tests
cd auditor-tests/tier2/auditor-namespace-notification-silence
make
